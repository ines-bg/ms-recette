name: Log Components URLs

on:
  workflow_call:

jobs:
  log-urls:
    name: Log All Component URLs
    runs-on: ubuntu-22.04
    timeout-minutes: 5
    steps:
      - name: Download service URL artifact
        uses: actions/download-artifact@v4
        with:
          name: service-url
          path: ./


      - name: Display all component URLs
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘          ğŸŒ COMMENT ACCÃ‰DER AUX SERVICES              â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          # Read the main service URL
          if [ -f "service-url.txt" ]; then
            SERVICE_URL=$(cat service-url.txt)
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo "â„¹ï¸  DÃ‰PLOIEMENT CI/CD (GitHub Actions)"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo "ğŸ¤– URL interne (Minikube): $SERVICE_URL"
            echo "âš ï¸  Cette URL n'est PAS accessible depuis votre navigateur"
            echo "ğŸ“Œ Usage: Tests d'intÃ©gration automatiques uniquement"
            echo ""
          else
            echo "âŒ Service URL not found!"
            echo ""
          fi
          
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘       ğŸŒ ACCÃˆS VIA NAVIGATEUR WEB (2 OPTIONS)        â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… OPTION 1 : Docker Compose Local (RECOMMANDÃ‰)"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ğŸ“‹ Depuis votre PC Windows :"
          echo "   1. Ouvrir PowerShell dans le dossier du projet"
          echo "   2. ExÃ©cuter : .\start-local-env.ps1"
          echo "   3. Attendre 30 secondes"
          echo ""
          echo "ğŸŒ URLs accessibles dans votre navigateur :"
          echo "   ğŸš€ API :           http://localhost:8080"
          echo "   ğŸ“ Health :        http://localhost:8080/health"
          echo "   ğŸ“ Status :        http://localhost:8080/api/status"
          echo "   ğŸ“ DB Test :       http://localhost:8080/api/database/test"
          echo "   ğŸ’¾ phpMyAdmin :    http://localhost:8081"
          echo "   ğŸƒ Mongo Express : http://localhost:8082"
          echo "   ğŸ“¦ MinIO :         http://localhost:9001"
          echo ""
          echo "ğŸ”‘ Identifiants :"
          echo "   MySQL/phpMyAdmin : root / password"
          echo "   MongoDB :          admin / password"
          echo "   MinIO :            minioadmin / minioadmin"
          echo ""
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… OPTION 2 : Kubernetes Local (Docker Desktop)"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ğŸ“‹ PrÃ©requis :"
          echo "   - Docker Desktop avec Kubernetes activÃ©"
          echo ""
          echo "ğŸ“‹ Commandes :"
          echo "   1. ExÃ©cuter : .\deploy-kubernetes-local.ps1"
          echo "   2. Les URLs seront affichÃ©es automatiquement"
          echo "   3. Exemple : http://localhost:<NodePort>"
          echo ""
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“š Documentation Disponible"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ğŸ“– Consultez ces guides dans le dÃ©pÃ´t :"
          echo "   â€¢ GUIDE-DEMARRAGE-LOCAL.md"
          echo "   â€¢ RESOLUTION-PROBLEMES-NEWMAN.md"
          echo "   â€¢ CORRECTIONS-INTEGRATION-TESTS.md"
          echo ""
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âš¡ Commandes Rapides"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ğŸš€ DÃ©marrer environnement local :"
          echo "   .\start-local-env.ps1"
          echo ""
          echo "ğŸ›‘ ArrÃªter environnement :"
          echo "   .\stop-local-env.ps1"
          echo ""
          echo "ğŸ§ª Tester avec Newman :"
          echo "   .\test-newman-local.ps1"
          echo ""
          echo "ğŸ“Š Ã‰tat Docker Compose :"
          echo "   docker-compose ps"
          echo ""
          
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘                 ğŸ“Š RÃ‰SUMÃ‰                             â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "âœ… Tests d'intÃ©gration CI/CD : RÃ‰USSIS"
          echo "âœ… Application dÃ©ployÃ©e dans Minikube (GitHub Actions)"
          echo "â„¹ï¸  Pour tester localement : .\start-local-env.ps1"
          echo ""
          echo "ğŸ¯ URLs Minikube (CI/CD uniquement) :"
          if [ -f "service-url.txt" ]; then
            SERVICE_URL=$(cat service-url.txt)
            echo "   Minikube Internal: $SERVICE_URL"
          fi
          echo ""
          echo "ğŸŒ URLs Accessibles (DÃ©ploiement Local) :"
          echo "   API:        http://localhost:8080"
          echo "   phpMyAdmin: http://localhost:8081"
          echo "   MinIO:      http://localhost:9001"
          echo ""

      - name: Create comprehensive URLs artifact
        run: |
          SERVICE_URL=$(cat service-url.txt 2>/dev/null || echo "N/A")
          
          cat > component-urls.txt << 'EOF'
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘       ğŸŒ COMMENT ACCÃ‰DER AUX SERVICES VIA NAVIGATEUR  â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          âš ï¸  IMPORTANT : Les URLs Minikube du CI/CD ne sont PAS accessibles
          depuis votre navigateur. Voici comment accÃ©der rÃ©ellement aux services :
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          âœ… OPTION 1 : Docker Compose Local (RECOMMANDÃ‰)
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          1. Ouvrir PowerShell dans le dossier du projet
          2. ExÃ©cuter : .\start-local-env.ps1
          3. Attendre 30 secondes
          
          ğŸŒ URLs accessibles dans votre navigateur :
             ğŸš€ API :           http://localhost:8080
             ğŸ“ Health :        http://localhost:8080/health
             ğŸ“ Status :        http://localhost:8080/api/status
             ğŸ“ DB Test :       http://localhost:8080/api/database/test
             ğŸ’¾ phpMyAdmin :    http://localhost:8081
             ğŸƒ Mongo Express : http://localhost:8082
             ğŸ“¦ MinIO :         http://localhost:9001
          
          ğŸ”‘ Identifiants :
             MySQL/phpMyAdmin : root / password
             MongoDB :          admin / password
             MinIO :            minioadmin / minioadmin
          
          ğŸ›‘ ArrÃªter : .\stop-local-env.ps1
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          âœ… OPTION 2 : Kubernetes Local (Docker Desktop)
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          PrÃ©requis : Docker Desktop avec Kubernetes activÃ©
          
          1. ExÃ©cuter : .\deploy-kubernetes-local.ps1
          2. Les URLs NodePort seront affichÃ©es automatiquement
          3. Ouvrir les URLs dans votre navigateur
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          ğŸ“š Documentation
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          Consultez ces guides :
          â€¢ GUIDE-DEMARRAGE-LOCAL.md - Setup complet en 30 secondes
          â€¢ RESOLUTION-PROBLEMES-NEWMAN.md - Debugging
          â€¢ CORRECTIONS-INTEGRATION-TESTS.md - Architecture CI/CD
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          â„¹ï¸  URL CI/CD (Tests Automatiques Uniquement)
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          Minikube Internal (GitHub Actions):
          EOF
          
          echo "  $SERVICE_URL" >> component-urls.txt
          echo "" >> component-urls.txt
          echo "âš ï¸  Cette URL n'est pas accessible depuis votre PC." >> component-urls.txt
          echo "   Elle est utilisÃ©e uniquement pour les tests Newman automatiques." >> component-urls.txt
          
          cat component-urls.txt

      - name: Upload URLs artifact
        uses: actions/upload-artifact@v4
        with:
          name: component-urls
          path: component-urls.txt
          retention-days: 7

